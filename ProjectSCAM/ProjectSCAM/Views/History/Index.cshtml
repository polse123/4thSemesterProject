@{
    ViewData["Title"] = "History";
}

@model IList<ProjectSCAM.Models.BatchModel>

@Styles.Render("~/Content/optimization.css")
@Styles.Render("~/Content/UserStyleSheet.css")
<!DOCTYPE html>
<html lang="en">
<head>
</head>
<body>
    <div>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
    </div>
    <table class="batchtableclass" id="batchtable">
        <tbody>
            <tr>
                <form action="/history/getbatchesbyid" method="get">
                    <input type="hidden" name="id" value="1" />
                    <input type="submit" value="batch 1" />
                </form>
            </tr>
        </tbody>
    </table>


    <div id="chartContainer" style="height: 370px; width: 100%;"></div>
</body>
</html>

<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
<script>
    var result;

    function drawChartForTemperature() {
        console.log("lol");
        result = @Html.Raw(ViewBag.Datapoints);
        var dataPoints = [];
        console.log(result);
        var min = 0;
        var max = 0;


        for (var i = 0; i < result.Values.TemperatureValues.length; i++) {
            dataPoints.push({ x: new Date(result.Values.TemperatureValues[i].Key), y: result.Values.TemperatureValues[i].Value });
            console.log(result.Values.TemperatureValues[i].Key);
            console.log(result.Values.TemperatureValues[i].Value);
            
            if (min > result.Values.TemperatureValues[i].Value) {
                min = i;
            }
            if (max < result.Values.TemperatureValues[i].Value) {
                max = i;
            }
        }
      
            var chart = new CanvasJS.Chart("chartContainer", {
                animationEnabled: true,
                title: {
                    text: "Number of iPhones Sold in Different Quarters"
                },
                axisX: {
                    minimum: new Date(result.TimestampStart),
                    maximum: new Date(result.TimestampEnd),
                },
                axisY: {
                    minimum: result.Values.TemperatureValues[min].Value,
                    maximum: result.Values.TemperatureValues[max].Value,
                    title: "Number of Sales",
                    titleFontColor: "#4F81BC",
                    suffix: " C"
                },
                data: [{
                    indexLabelFontColor: "darkSlateGray",
                    name: "views",
                    type: "area",
                    yValueFormatString: "#,##0.0 C",
                    dataPoints: dataPoints,
                }]
            });
            chart.render();

    }

    drawChartForTemperature();
</script>
<script>
    function stringToDate(_date, _format, _delimiter) {
        var formatLowerCase = _format.toLowerCase();
        var formatItems = formatLowerCase.split(_delimiter);
        var dateItems = _date.split(_delimiter);
        var monthIndex = formatItems.indexOf("mm");
        var dayIndex = formatItems.indexOf("dd");
        var yearIndex = formatItems.indexOf("yyyy");
        var month = parseInt(dateItems[monthIndex]);
        month -= 1;
        var formatedDate = new Date(dateItems[yearIndex], month, dateItems[dayIndex]);
        return formatedDate;
    }
</script>

